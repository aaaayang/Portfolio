---
title: "Basic Questions For Curated and Collated SCFA Data"
author: "Alex Yang"
date: "9/21/2020"
output:
  html_document: default
  pdf_document: default
---
#Loading Appropriate Packages 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('dplyr')
library('tidyverse')
library('ggplot2')
library('scales')
library('ggpubr')
```

```{r}
#Always Account for Working Directory
getwd()
```

#-------------------------------------------------------------------------------

#SCFA vs. PH
##SCFA vs. PH for Week 1 and Week 3 (Participants Averaged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample <- read.csv("./fecalsample.csv")
fecal_clean <- fullfecalsample %>%
  na.omit() %>%
  select(-starts_with("avg.group.count"), 
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1" | Week == "week3") %>%
  mutate(scfa_sum = rowSums(.[3:6]))

#Preparing Data for Scatterplot Creation 
fecal_clean$Ph.avg = as.numeric(fecal_clean$Ph.avg)
fecal_clean$scfa_sum = as.numeric(fecal_clean$scfa_sum)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean, aes(x=Ph.avg, y=scfa_sum)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for All Weeks") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean, aes(x=Ph.avg, y=scfa_sum)) +
  geom_smooth() +
  ggtitle("SCFA vs. PH for All Weeks") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean, aes(x=Ph.avg, y=scfa_sum)) +
  geom_point() +
  geom_smooth() +
  ggtitle("SCFA vs. PH for All Weeks") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean$Ph.avg), as.vector(fecal_clean$scfa_sum),
    method = "pearson") #Returns -0.1471749. Low negative correlation 

#Significance Statistics
qqplot(as.vector(fecal_clean$Ph.avg), as.vector(fecal_clean$scfa_sum))
bartlett.test(scfa_sum ~ Week, data = fecal_clean)
cor.test(as.vector(fecal_clean$Ph.avg), as.vector(fecal_clean$scfa_sum), 
         alternative = "less", method = 'pearson')
```

##SCFA vs. PH for Week 1 and Week 3 (Participants Unaveraged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample_unaveraged <- read.csv("./fecalsample_unaveraged.csv")
fecal_clean_ua <- fullfecalsample_unaveraged %>%
  na.omit() %>%
  select(-starts_with("Final.weight"),
         -starts_with("Number"),
         -starts_with("Name"),
         -starts_with("Bristol")) %>%
  filter(Week == "week1" | Week == "week3") %>%
  mutate(scfa_sum = rowSums(.[4:6]))

#Preparing Data for Scatterplot Creation 
fecal_clean_ua$pH = as.numeric(fecal_clean_ua$pH)
fecal_clean_ua$scfa_sum = as.numeric(fecal_clean_ua$scfa_sum)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean_ua, aes(x=pH, y=scfa_sum)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for All Weeks") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean_ua, aes(x=pH, y=scfa_sum)) +
  geom_smooth() +
  ggtitle("SCFA vs. PH for All Weeks") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean_ua, aes(x=pH, y=scfa_sum)) +
  geom_point() +
  geom_smooth() +
  ggtitle("SCFA vs. PH for All Weeks") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean_ua$pH), as.vector(fecal_clean_ua$scfa_sum),
    method = "pearson") #Returns -0.1765633. Low negative correlation

#Significance Statistics
qqplot(as.vector(fecal_clean_ua$pH), as.vector(fecal_clean_ua$scfa_sum))
bartlett.test(scfa_sum ~ Week, data = fecal_clean_ua)
cor.test(as.vector(fecal_clean_ua$pH), as.vector(fecal_clean_ua$scfa_sum), 
         alternative = "less", method = 'pearson')
```



##SCFA vs. PH for Week 1 Only (Participants Averaged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample <- read.csv("./fecalsample.csv")
fecal_clean1 <- fullfecalsample %>%
  na.omit() %>%
  select(-starts_with("avg.group.count"), 
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1") %>%
  mutate(scfa_sum = rowSums(.[3:6]))

#Preparing Data for Scatterplot Creation 
fecal_clean1$Ph.avg = as.numeric(fecal_clean1$Ph.avg)
fecal_clean1$scfa_sum = as.numeric(fecal_clean1$scfa_sum)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean1, aes(x=Ph.avg, y=scfa_sum)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean1, aes(x=Ph.avg, y=scfa_sum)) +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean1, aes(x=Ph.avg, y=scfa_sum)) +
  geom_point() +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean1$Ph.avg), as.vector(fecal_clean1$scfa_sum),
    method = "pearson") #Returns -0.2279144. Negative correlation

#Significance Statistics
cor.test(as.vector(fecal_clean1$Ph.avg), as.vector(fecal_clean1$scfa_sum), 
         alternative = "less", method = 'pearson')
```

##SCFA vs. PH for Week 1 Only (Participants Unaveraged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample_unaveraged <- read.csv("./fecalsample_unaveraged.csv")
fecal_clean_ua_wk1 <- fullfecalsample_unaveraged %>%
  na.omit() %>%
  select(-starts_with("Final.weight"),
         -starts_with("Number"),
         -starts_with("Name"),
         -starts_with("Bristol")) %>%
  filter(Week == "week1") %>%
  mutate(scfa_sum = rowSums(.[4:6]))

#Preparing Data for Scatterplot Creation 
fecal_clean_ua_wk1$pH = as.numeric(fecal_clean_ua_wk1$pH)
fecal_clean_ua_wk1$scfa_sum = as.numeric(fecal_clean_ua_wk1$scfa_sum)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean_ua_wk1, aes(x=pH, y=scfa_sum)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean_ua_wk1, aes(x=pH, y=scfa_sum)) +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean_ua_wk1, aes(x=pH, y=scfa_sum)) +
  geom_point() +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean_ua_wk1$pH), as.vector(fecal_clean_ua_wk1$scfa_sum),
    method = "pearson") #Returns -0.2134114. Negative correlation

#Significance Statistics
cor.test(as.vector(fecal_clean_ua_wk1$pH), as.vector(fecal_clean_ua_wk1$scfa_sum), 
         alternative = "less", method = 'pearson')
```


##SCFA vs. PH for Week 3 Only (Participants Averaged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample <- read.csv("./fecalsample.csv")
fecal_clean3 <- fullfecalsample %>%
  na.omit() %>%
  select(-starts_with("avg.group.count"), 
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week3") %>%
  mutate(scfa_sum = rowSums(.[3:6]))

#Preparing Data for Scatterplot Creation 
fecal_clean3$Ph.avg = as.numeric(fecal_clean3$Ph.avg)
fecal_clean3$scfa_sum = as.numeric(fecal_clean3$scfa_sum)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean3, aes(x=Ph.avg, y=scfa_sum)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for Week 3") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean3, aes(x=Ph.avg, y=scfa_sum)) +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 3") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean3, aes(x=Ph.avg, y=scfa_sum)) +
  geom_point() +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 3") +
  labs(y= "Total SCFA", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean3$Ph.avg), as.vector(fecal_clean3$scfa_sum),
    method = "pearson") #Returns -0.07775739. Very low negative correlation.

#Significance Statistics
cor.test(as.vector(fecal_clean3$Ph.avg), as.vector(fecal_clean3$scfa_sum), 
         alternative = "less", method = 'pearson')
```

##SCFA vs. PH for Week 3 Only (Participants Unaveraged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample_unaveraged <- read.csv("./fecalsample_unaveraged.csv")
fecal_clean_ua_wk3 <- fullfecalsample_unaveraged %>%
  na.omit() %>%
  select(-starts_with("Final.weight"),
         -starts_with("Number"),
         -starts_with("Name"),
         -starts_with("Bristol")) %>%
  filter(Week == "week3") %>%
  mutate(scfa_sum = rowSums(.[4:6]))

#Preparing Data for Scatterplot Creation 
fecal_clean_ua_wk3$pH = as.numeric(fecal_clean_ua_wk3$pH)
fecal_clean_ua_wk3$scfa_sum = as.numeric(fecal_clean_ua_wk3$scfa_sum)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean_ua_wk3, aes(x=pH, y=scfa_sum)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for Week 3") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean_ua_wk3, aes(x=pH, y=scfa_sum)) +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 3") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean_ua_wk3, aes(x=pH, y=scfa_sum)) +
  geom_point() +
  geom_smooth() +
  ggtitle("SCFA vs. PH for Week 3") +
  labs(y= "Total SCFA", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean_ua_wk3$pH), as.vector(fecal_clean_ua_wk3$scfa_sum),
    method = "pearson") #Returns -0.1438332. Negative correlation

#Significance Statistics
cor.test(as.vector(fecal_clean_ua_wk3$pH), as.vector(fecal_clean_ua_wk3$scfa_sum),
         alternative = "less", method = 'pearson')
```

#-------------------------------------------------------------------------------

#BRMPS 2x Daily Cohort 
##Acetate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps <- participantsupps %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 2xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Acetate
fecal1_acetate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_brmps <- merge(fecal1_acetate,participantsupps,by="Participant") %>%
  rename(rel.acetate.wk1 = Acetate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Acetate
fecal3_acetate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_brmps <- merge(fecal3_acetate,participantsupps,by="Participant") %>%
  rename(rel.acetate.wk3 = Acetate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Acetate DFs for Larger DF
acetate_brmps <- merge(fecal1_brmps,fecal3_brmps,by="Participant") 

#Appending Differences column to acetate-BRMPS df in form: week3-week1
acetate_brmps_diff <- acetate_brmps %>%
  mutate(acetate_diff = rel.acetate.wk3 - rel.acetate.wk1) %>%
  arrange(by = acetate_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Acetate Data
acetate_wk1_vec <- as.vector(acetate_brmps$rel.acetate.wk1)
acetate_wk3_vec <- as.vector(acetate_brmps$rel.acetate.wk3)
paired_acetate_df <- data.frame(Week1 = acetate_wk1_vec, Week3 = acetate_wk3_vec)
acetatepairplot <- ggpaired(paired_acetate_df, cond1 = "Week1", cond2 = "Week3")
acetatepairplot$layers <- acetatepairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Acetate
##t-test means (wk1-wk3) difference
t.test(as.vector(acetate_brmps$rel.acetate.wk1), 
       as.vector(acetate_brmps$rel.acetate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(acetate_brmps_diff)
acetatepairplot
acebrmps2x_barplot <- barplot(acetate_brmps_diff$acetate_diff, ylab = "Participants", xlab = "Acetate. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 2x Daily Acetate Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(acetate_brmps_diff)
```

##Acetate Proportion in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps <- participantsupps %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 2xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Acetate
fecal1_acetateprop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5])) %>%
  mutate(acetate_prop1 = Acetate.rel.avg / scfa_sum)

fecal1_brmpsprop <- merge(fecal1_acetateprop,participantsupps,by="Participant") %>%
  rename(acetate_prop_wk1 = acetate_prop1) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Acetate
fecal3_acetateprop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5])) %>%
  mutate(acetate_prop3 = Acetate.rel.avg / scfa_sum)

fecal3_brmpsprop <- merge(fecal3_acetateprop,participantsupps,by="Participant") %>%
  rename(acetate_prop_wk3 = acetate_prop3) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Acetate DFs for Larger DF
acetate_brmpsprop <- merge(fecal1_brmpsprop,fecal3_brmpsprop,
                           by="Participant") %>%
                     select(-ends_with("x"), -ends_with("y"))

#Appending Differences column to acetate-BRMPS df in form: week3-week1
acetate_brmps_diffprop <- acetate_brmpsprop %>%
  mutate(acetate_prop_diff = acetate_prop_wk3 - acetate_prop_wk1) %>%
  arrange(by = acetate_prop_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Acetate Data
acetate_wk1_vecprop <- as.vector(acetate_brmps_diffprop$acetate_prop_wk1)
acetate_wk3_vecprop <- as.vector(acetate_brmps_diffprop$acetate_prop_wk3)
paired_acetate_dfprop <- data.frame(Week1 = acetate_wk1_vecprop, 
                                    Week3 = acetate_wk3_vecprop)
acetatepairplotprop <- ggpaired(paired_acetate_dfprop, cond1 = "Week1", 
                                cond2 = "Week3")
acetatepairplotprop$layers <- acetatepairplotprop$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Acetate
##t-test means (wk1-wk3) difference
t.test(as.vector(acetate_brmpsprop$acetate_prop_wk1), 
       as.vector(acetate_brmpsprop$acetate_prop_wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(acetate_brmpsprop) # p-value = 0.0971. 
acetatepairplotprop
aceprop2x_barplot <- barplot(acetate_brmps_diffprop$acetate_prop_diff, ylab = "Participants", xlab = "Acetate Prop. Change (Week 3 - Week 1)", 
        main = "BRMPS 2x Daily Acetate Prop. Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(acetate_brmpsprop)
```

##Butyrate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps <- participantsupps %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 2xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Butyrate
fecal1_butyrate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_brmps_but <- merge(fecal1_butyrate,participantsupps,by="Participant") %>%
  rename(rel.butyrate.wk1 = Butyrate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Butyrate
fecal3_butyrate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_brmps_but <- merge(fecal3_butyrate,participantsupps,by="Participant") %>%
  rename(rel.butyrate.wk3 = Butyrate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Butyrate DFs for Larger DF
butyrate_brmps <- merge(fecal1_brmps_but,fecal3_brmps_but,by="Participant") 

#Appending Differences column to Butyrate-BRMPS df in form: week3-week1
butyrate_brmps_diff <- butyrate_brmps %>%
  mutate(butyrate_diff = rel.butyrate.wk3 - rel.butyrate.wk1) %>%
  arrange(by = butyrate_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Butyrate Data
butyrate_wk1_vec <- as.vector(butyrate_brmps$rel.butyrate.wk1)
butyrate_wk3_vec <- as.vector(butyrate_brmps$rel.butyrate.wk3)
paired_butyrate_df <- data.frame(Week1 = butyrate_wk1_vec, Week3 = butyrate_wk3_vec)
butyratepairplot <- ggpaired(paired_butyrate_df, cond1 = "Week1", cond2 = "Week3")
butyratepairplot$layers <- butyratepairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Butyrate
##t-test means (wk1-wk3) difference
t.test(as.vector(butyrate_brmps$rel.butyrate.wk1), 
       as.vector(butyrate_brmps$rel.butyrate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(butyrate_brmps_diff)
butyratepairplot
butbrmps2x_barplot <- barplot(butyrate_brmps_diff$butyrate_diff, ylab = "Participants", xlab = "But. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 2x Daily Butyrate Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(butyrate_brmps_diff)
```

##Propionate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps <- participantsupps %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 2xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Propionate
fecal1_prop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_brmps_prop <- merge(fecal1_prop,participantsupps,by="Participant") %>%
  rename(rel.propionate.wk1 = Propionate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Propionate
fecal3_prop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_brmps_prop <- merge(fecal3_prop,participantsupps,by="Participant") %>%
  rename(rel.propionate.wk3 = Propionate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Propionate DFs for Larger DF
prop_brmps <- merge(fecal1_brmps_prop,fecal3_brmps_prop,by="Participant") 

#Appending Differences column to Propionate-BRMPS df in form: week3-week1
prop_brmps_diff <- prop_brmps %>%
  mutate(prop_diff = rel.propionate.wk3 - rel.propionate.wk1) %>%
  arrange(by = prop_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Propionate Data
prop_wk1_vec <- as.vector(prop_brmps$rel.propionate.wk1)
prop_wk3_vec <- as.vector(prop_brmps$rel.propionate.wk3)
paired_prop_df <- data.frame(Week1 = prop_wk1_vec, Week3 = prop_wk3_vec)
proppairplot <- ggpaired(paired_prop_df, cond1 = "Week1", cond2 = "Week3")
proppairplot$layers <- proppairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Propionate
##t-test means (wk1-wk3) difference
t.test(as.vector(prop_brmps$rel.propionate.wk1), 
       as.vector(prop_brmps$rel.propionate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(prop_brmps_diff)
proppairplot
propbrmps2x_barplot <- barplot(prop_brmps_diff$prop_diff, ylab = "Participants", 
        xlab = "Prop. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 2x Daily Prop. Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(prop_brmps_diff)
```

##Total SCFA Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps <- participantsupps %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 2xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Total SCFAs
fecal1_tot <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5]))

fecal1_brmps_tot <- merge(fecal1_tot,participantsupps,by="Participant") %>%
  rename(scfa_sum_wk1 = scfa_sum) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Total SCFAs
fecal3_tot <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.abs.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5]))

fecal3_brmps_tot <- merge(fecal3_tot,participantsupps,by="Participant") %>%
  rename(scfa_sum_wk3 = scfa_sum) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Total SCFAs DFs for Larger DF
tot_brmps <- merge(fecal1_brmps_tot,fecal3_brmps_tot,by="Participant") %>%
  select(starts_with("Participant"),
         starts_with("scfa_sum"))

#Appending Differences column to Total SCFA-BRMPS df in form: week3-week1
tot_brmps_diff <- tot_brmps %>%
  mutate(tot_diff = scfa_sum_wk3 - scfa_sum_wk1) %>%
  arrange(by = tot_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Total SCFA Data
tot_wk1_vec <- as.vector(tot_brmps$scfa_sum_wk1)
tot_wk3_vec <- as.vector(tot_brmps$scfa_sum_wk3)
paired_tot_df <- data.frame(Week1 = tot_wk1_vec, Week3 = tot_wk3_vec)
totpairplot <- ggpaired(paired_tot_df, cond1 = "Week1", cond2 = "Week3")
totpairplot$layers <- totpairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Total SCFA
##t-test means (wk1-wk3) difference
t.test(as.vector(tot_brmps$scfa_sum_wk1), 
       as.vector(tot_brmps$scfa_sum_wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(tot_brmps_diff)
totpairplot
totscfabrmps2x_barplot <- barplot(tot_brmps_diff$tot_diff, ylab = "Participants",
        xlab = "Tot. SCFA Conc. Change (Wk 3 - Wk 1)", 
        main = "BRMPS 2x Daily Tot. SCFA Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(tot_brmps_diff)
```

##pH Change in BRMPS 2x Cohort from Week 1 to Week 3
```{r}
#Making Week 1 BRMPS 2x-pH Data Frame 
ph_brmps_wk1 <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

#Making Week 3 BRMPS 2x-pH Data Frame 
ph_brmps_wk3 <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

#Combining Week 1 and Week 3 BRMPS 2x Daily Cohort 
merged_ph_wks <- merge(ph_brmps_wk1, ph_brmps_wk3, by = "Participant") 
merged_ph_brmps<- merge(merged_ph_wks, participantsupps, by = "Participant")
merged_ph_brmps <- merged_ph_brmps %>%
  rename(ph_wk1 = "Ph.avg.x", ph_wk3 = "Ph.avg.y",) %>%
  select(starts_with("Participant"), starts_with("ph_wk")) %>%
  mutate(ph_diff = ph_wk3 - ph_wk1) %>%
  arrange(by_group = ph_diff)

#Summary Statistics and Visualizations for BRMPS 2x Daily pH Change
nrow(merged_ph_brmps) #n = 27 for cohort with pH data and BRMPS 2x Daily. 
t.test(as.vector(merged_ph_brmps$ph_wk1), 
       as.vector(merged_ph_brmps$ph_wk3),
       alternative = "greater",
       paired = TRUE,
       conf.level = 0.95)
summary(merged_ph_brmps)
ph_brmps2x_barplot <- barplot(merged_ph_brmps$ph_diff, ylab = "Participants", 
        xlab = "pH (Week 3 - Week 1)", 
        main = "BRMPS 2x Daily pH Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(merged_ph_brmps)
```

#-------------------------------------------------------------------------------

#BRMPS 1x Daily Cohort 
##Acetate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps1 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps1 <- participantsupps1 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 1xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Acetate
fecal1_acetate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_brmps <- merge(fecal1_acetate,participantsupps1,by="Participant") %>%
  rename(rel.acetate.wk1 = Acetate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Acetate
fecal3_acetate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_brmps <- merge(fecal3_acetate,participantsupps1,by="Participant") %>%
  rename(rel.acetate.wk3 = Acetate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Acetate DFs for Larger DF
acetate_brmps <- merge(fecal1_brmps,fecal3_brmps,by="Participant") 

#Appending Differences column to acetate-BRMPS df in form: week3-week1
acetate_brmps_diff <- acetate_brmps %>%
  mutate(acetate_diff = rel.acetate.wk3 - rel.acetate.wk1) %>%
  arrange(by = acetate_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Acetate Data
acetate_wk1_vec <- as.vector(acetate_brmps$rel.acetate.wk1)
acetate_wk3_vec <- as.vector(acetate_brmps$rel.acetate.wk3)
paired_acetate_df <- data.frame(Week1 = acetate_wk1_vec, Week3 = acetate_wk3_vec)
acetatepairplot <- ggpaired(paired_acetate_df, cond1 = "Week1", cond2 = "Week3")
acetatepairplot$layers <- acetatepairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Acetate
##t-test means (wk1-wk3) difference
t.test(as.vector(acetate_brmps$rel.acetate.wk1), 
       as.vector(acetate_brmps$rel.acetate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(acetate_brmps_diff)
acetatepairplot
acebrmps1x_barplot <- barplot(acetate_brmps_diff$acetate_diff, ylab = "Participants", xlab = "Acet. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 1x Daily Acetate Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(acetate_brmps_diff)
```

##Acetate Proportion in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps1 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps1 <- participantsupps1 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 1xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Acetate
fecal1_acetateprop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5])) %>%
  mutate(acetate_prop1 = Acetate.rel.avg / scfa_sum)

fecal1_brmpsprop <- merge(fecal1_acetateprop,participantsupps1,by="Participant") %>%
  rename(acetate_prop_wk1 = acetate_prop1) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Acetate
fecal3_acetateprop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5])) %>%
  mutate(acetate_prop3 = Acetate.rel.avg / scfa_sum)

fecal3_brmpsprop <- merge(fecal3_acetateprop,participantsupps1,by="Participant") %>%
  rename(acetate_prop_wk3 = acetate_prop3) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Acetate DFs for Larger DF
acetate_brmpsprop <- merge(fecal1_brmpsprop,fecal3_brmpsprop,
                           by="Participant") %>%
                     select(-ends_with("x"), -ends_with("y"))

#Appending Differences column to acetate-BRMPS df in form: week3-week1
acetate_brmps_diffprop <- acetate_brmpsprop %>%
  mutate(acetate_prop_diff = acetate_prop_wk3 - acetate_prop_wk1) %>%
  arrange(by = acetate_prop_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Acetate Data
acetate_wk1_vecprop <- as.vector(acetate_brmps_diffprop$acetate_prop_wk1)
acetate_wk3_vecprop <- as.vector(acetate_brmps_diffprop$acetate_prop_wk3)
paired_acetate_dfprop <- data.frame(Week1 = acetate_wk1_vecprop, 
                                    Week3 = acetate_wk3_vecprop)
acetatepairplotprop <- ggpaired(paired_acetate_dfprop, cond1 = "Week1", 
                                cond2 = "Week3")
acetatepairplotprop$layers <- acetatepairplotprop$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Acetate
##t-test means (wk1-wk3) difference
t.test(as.vector(acetate_brmpsprop$acetate_prop_wk1), 
       as.vector(acetate_brmpsprop$acetate_prop_wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(acetate_brmps_diffprop) # p-value = 0.0971. 
acetatepairplotprop
aceprop1x_barplot <- barplot(acetate_brmps_diffprop$acetate_prop_diff, ylab = "Participants", xlab = "Acetate Prop. Change (Week 3 - Week 1)", 
        main = "BRMPS 1x Daily Ace. Prop. Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(acetate_brmps_diffprop)
```

##Butyrate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps1 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps1 <- participantsupps1 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 1xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Butyrate
fecal1_butyrate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_brmps_but <- merge(fecal1_butyrate,participantsupps1,by="Participant") %>%
  rename(rel.butyrate.wk1 = Butyrate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Butyrate
fecal3_butyrate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_brmps_but <- merge(fecal3_butyrate,participantsupps1,by="Participant") %>%
  rename(rel.butyrate.wk3 = Butyrate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Butyrate DFs for Larger DF
butyrate_brmps <- merge(fecal1_brmps_but,fecal3_brmps_but,by="Participant") 

#Appending Differences column to Butyrate-BRMPS df in form: week3-week1
butyrate_brmps_diff <- butyrate_brmps %>%
  mutate(butyrate_diff = rel.butyrate.wk3 - rel.butyrate.wk1) %>%
  arrange(by = butyrate_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Butyrate Data
butyrate_wk1_vec <- as.vector(butyrate_brmps$rel.butyrate.wk1)
butyrate_wk3_vec <- as.vector(butyrate_brmps$rel.butyrate.wk3)
paired_butyrate_df <- data.frame(Week1 = butyrate_wk1_vec, Week3 = butyrate_wk3_vec)
butyratepairplot <- ggpaired(paired_butyrate_df, cond1 = "Week1", cond2 = "Week3")
butyratepairplot$layers <- butyratepairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Butyrate
##t-test means (wk1-wk3) difference
t.test(as.vector(butyrate_brmps$rel.butyrate.wk1), 
       as.vector(butyrate_brmps$rel.butyrate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(butyrate_brmps_diff)
butyratepairplot
butbrmps1x_barplot <- barplot(butyrate_brmps_diff$butyrate_diff, ylab = "Participants", xlab = "But. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 1x Daily Butyrate Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(butyrate_brmps_diff)
```

##Propionate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps1 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps1 <- participantsupps1 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 1xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Propionate
fecal1_prop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_brmps_prop <- merge(fecal1_prop,participantsupps1,by="Participant") %>%
  rename(rel.propionate.wk1 = Propionate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Propionate
fecal3_prop <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_brmps_prop <- merge(fecal3_prop,participantsupps1,by="Participant") %>%
  rename(rel.propionate.wk3 = Propionate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Propionate DFs for Larger DF
prop_brmps <- merge(fecal1_brmps_prop,fecal3_brmps_prop,by="Participant") 

#Appending Differences column to Propionate-BRMPS df in form: week3-week1
prop_brmps_diff <- prop_brmps %>%
  mutate(prop_diff = rel.propionate.wk3 - rel.propionate.wk1) %>%
  arrange(by = prop_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Propionate Data
prop_wk1_vec <- as.vector(prop_brmps$rel.propionate.wk1)
prop_wk3_vec <- as.vector(prop_brmps$rel.propionate.wk3)
paired_prop_df <- data.frame(Week1 = prop_wk1_vec, Week3 = prop_wk3_vec)
proppairplot <- ggpaired(paired_prop_df, cond1 = "Week1", cond2 = "Week3")
proppairplot$layers <- proppairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Propionate
##t-test means (wk1-wk3) difference
t.test(as.vector(prop_brmps$rel.propionate.wk1), 
       as.vector(prop_brmps$rel.propionate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(prop_brmps_diff)
proppairplot
propbrmps1x_barplot <- barplot(prop_brmps_diff$prop_diff, ylab = "Participants", 
        xlab = "Prop. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 1x Daily Prop. Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(prop_brmps_diff)
```

##Total SCFA Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps1 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps1 <- participantsupps1 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Quantity.compliant == "yes") %>%
  filter(Supplement.consumed == "BRMPS 1xdaily 40") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Total SCFAs
fecal1_tot <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5]))

fecal1_brmps_tot <- merge(fecal1_tot,participantsupps1,by="Participant") %>%
  rename(scfa_sum_wk1 = scfa_sum) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Total SCFAs
fecal3_tot <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.abs.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5]))

fecal3_brmps_tot <- merge(fecal3_tot,participantsupps1,by="Participant") %>%
  rename(scfa_sum_wk3 = scfa_sum) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Total SCFAs DFs for Larger DF
tot_brmps <- merge(fecal1_brmps_tot,fecal3_brmps_tot,by="Participant") %>%
  select(starts_with("Participant"),
         starts_with("scfa_sum"))

#Appending Differences column to Total SCFA-BRMPS df in form: week3-week1
tot_brmps_diff <- tot_brmps %>%
  mutate(tot_diff = scfa_sum_wk3 - scfa_sum_wk1) %>%
  arrange(by = tot_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Total SCFA Data
tot_wk1_vec <- as.vector(tot_brmps$scfa_sum_wk1)
tot_wk3_vec <- as.vector(tot_brmps$scfa_sum_wk3)
paired_tot_df <- data.frame(Week1 = tot_wk1_vec, Week3 = tot_wk3_vec)
totpairplot <- ggpaired(paired_tot_df, cond1 = "Week1", cond2 = "Week3")
totpairplot$layers <- totpairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Total SCFA
##t-test means (wk1-wk3) difference
t.test(as.vector(tot_brmps$scfa_sum_wk1), 
       as.vector(tot_brmps$scfa_sum_wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(tot_brmps_diff)
totpairplot
totscfabrmps1x_barplot <- barplot(tot_brmps_diff$tot_diff, ylab = "Participants",
        xlab = "Tot. SCFA Conc. Change (Wk 3 - Wk 1)", 
        main = "BRMPS 1x Daily Tot. SCFA Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(tot_brmps_diff)
```

##pH Change in BRMPS 1x Cohort from Week 1 to Week 3
```{r}
#Making Week 1 BRMPS 1x-pH Data Frame 
ph_brmps_wk1 <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

#Making Week 3 BRMPS 1x-pH Data Frame 
ph_brmps_wk3 <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

#Combining Week 1 and Week 3 BRMPS 1x Daily Cohort 
merged_ph_wks <- merge(ph_brmps_wk1, ph_brmps_wk3, by = "Participant") 
merged_ph_brmps<- merge(merged_ph_wks, participantsupps1, by = "Participant")
merged_ph_brmps <- merged_ph_brmps %>%
  rename(ph_wk1 = "Ph.avg.x", ph_wk3 = "Ph.avg.y",) %>%
  select(starts_with("Participant"), starts_with("ph_wk")) %>%
  mutate(ph_diff = ph_wk3 - ph_wk1) %>%
  arrange(by_group = ph_diff)

#Summary Statistics and Visualizations for BRMPS 1x Daily pH Change
nrow(merged_ph_brmps) #n = 27 for cohort with pH data and BRMPS 2x Daily. 
t.test(as.vector(merged_ph_brmps$ph_wk1), 
       as.vector(merged_ph_brmps$ph_wk3),
       alternative = "greater",
       paired = TRUE,
       conf.level = 0.95)
summary(merged_ph_brmps)
ph_brmps1x_barplot <- barplot(merged_ph_brmps$ph_diff, ylab = "Participants", 
        xlab = "pH (Week 3 - Week 1)", 
        main = "BRMPS 1x Daily pH Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(merged_ph_brmps)
```

#-------------------------------------------------------------------------------

#BRMPS No Supplement Cohort 
##Acetate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps2 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps2 <- participantsupps2 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Supplement.consumed == "none") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Acetate
fecal1_acetate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_none <- merge(fecal1_acetate,participantsupps2,by="Participant") %>%
  rename(rel.acetate.wk1 = Acetate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Acetate
fecal3_acetate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_none <- merge(fecal3_acetate,participantsupps2,by="Participant") %>%
  rename(rel.acetate.wk3 = Acetate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Acetate DFs for Larger DF
acetate_none <- merge(fecal1_none,fecal3_none,by="Participant") 

#Appending Differences column to acetate-BRMPS df in form: week3-week1
acetate_none_diff <- acetate_none %>%
  mutate(acetate_diff = rel.acetate.wk3 - rel.acetate.wk1) %>%
  arrange(by = acetate_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Acetate Data
#acetate_wk1_vec <- as.vector(acetate_none$rel.acetate.wk1)
#acetate_wk3_vec <- as.vector(acetate_none$rel.acetate.wk3)
#paired_acetate_df <- data.frame(Week1 = acetate_wk1_vec, Week3 = acetate_wk3_vec)
#acetatepairplot <- ggpaired(paired_acetate_df, cond1 = "Week1", cond2 = "Week3")
#acetatepairplot$layers <- acetatepairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Acetate
##t-test means (wk1-wk3) difference
t.test(as.vector(acetate_none_diff$rel.acetate.wk1), 
       as.vector(acetate_none_diff$rel.acetate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(acetate_none_diff)
#acetatepairplot
acenone_barplot <- barplot(acetate_none_diff$acetate_diff, ylab = "Participants", xlab = "Acet. Conc. Change (Week 3 - Week 1)", 
        main = "No-Supp. Daily Acetate Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(acetate_none_diff)
```

##Butyrate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps2 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps2 <- participantsupps2 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Supplement.consumed == "none") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Butyrate
fecal1_butyrate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_none_but <- merge(fecal1_butyrate,participantsupps2,by="Participant") %>%
  rename(rel.butyrate.wk1 = Butyrate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Butyrate
fecal3_butyrate <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_none_but <- merge(fecal3_butyrate,participantsupps2,by="Participant") %>%
  rename(rel.butyrate.wk3 = Butyrate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Butyrate DFs for Larger DF
butyrate_none <- merge(fecal1_none_but,fecal3_none_but,by="Participant") 

#Appending Differences column to Butyrate-BRMPS df in form: week3-week1
butyrate_none_diff <- butyrate_none %>%
  mutate(butyrate_diff = rel.butyrate.wk3 - rel.butyrate.wk1) %>%
  arrange(by = butyrate_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Butyrate Data
#butyrate_wk1_vec <- as.vector(butyrate_brmps$rel.butyrate.wk1)
#butyrate_wk3_vec <- as.vector(butyrate_brmps$rel.butyrate.wk3)
#paired_butyrate_df <- data.frame(Week1 = butyrate_wk1_vec, Week3 = butyrate_wk3_vec)
#butyratepairplot <- ggpaired(paired_butyrate_df, cond1 = "Week1", cond2 = "Week3")
#butyratepairplot$layers <- butyratepairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Butyrate
##t-test means (wk1-wk3) difference
t.test(as.vector(butyrate_none$rel.butyrate.wk1), 
       as.vector(butyrate_none$rel.butyrate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(butyrate_none_diff)
#butyratepairplot
butnone_barplot <- barplot(butyrate_none_diff$butyrate_diff, ylab = "Participants", xlab = "But. Conc. Change (Week 3 - Week 1)", 
        main = "No-Supp. Cohort Butyrate Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(butyrate_none_diff)
```

##Propionate Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps2 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps2 <- participantsupps2 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Supplement.consumed == "none") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Propionate
fecal1_none <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

fecal1_none_prop <- merge(fecal1_prop,participantsupps2,by="Participant") %>%
  rename(rel.propionate.wk1 = Propionate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Propionate
fecal3_none <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

fecal3_none_prop <- merge(fecal3_prop,participantsupps2,by="Participant") %>%
  rename(rel.propionate.wk3 = Propionate.rel.avg) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Propionate DFs for Larger DF
prop_none <- merge(fecal1_none_prop,fecal3_none_prop,by="Participant") 

#Appending Differences column to Propionate-BRMPS df in form: week3-week1
prop_none_diff <- prop_none %>%
  mutate(prop_diff = rel.propionate.wk3 - rel.propionate.wk1) %>%
  arrange(by = prop_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Propionate Data
#prop_wk1_vec <- as.vector(prop_none$rel.propionate.wk1)
#prop_wk3_vec <- as.vector(prop_none$rel.propionate.wk3)
#paired_prop_df <- data.frame(Week1 = prop_wk1_vec, Week3 = prop_wk3_vec)
#proppairplot <- ggpaired(paired_prop_df, cond1 = "Week1", cond2 = "Week3")
#proppairplot$layers <- proppairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Propionate
##t-test means (wk1-wk3) difference
t.test(as.vector(prop_none$rel.propionate.wk1), 
       as.vector(prop_none$rel.propionate.wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(prop_none_diff)
proppairplot
propnone_barplot <- barplot(prop_none_diff$prop_diff, ylab = "Participants", 
        xlab = "Prop. Conc. Change (Week 3 - Week 1)", 
        main = "BRMPS 1x Daily Prop. Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(prop_none_diff)
```

##Total SCFA Concentration in Week 1 vs. Week 3 (Participants Averaged)
```{r}
#Making and Cleaning data frame with Participants by Supplement
participantsupps2 <- read.csv("./participant.csv")

#Filtering for Quality Compliance and Twice-Daily BRMPS Participants
participantsupps2 <- participantsupps2 %>%
  select(-starts_with("Data.consent")) %>%
  filter(Supplement.consumed == "none") %>%
  rename(Participant = Name)

#Making Week 1 Data Frame from BRMPS and Total SCFAs
fecal1_tot <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Propionate.abs.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5]))

fecal1_none_tot <- merge(fecal1_tot,participantsupps2,by="Participant") %>%
  rename(scfa_sum_wk1 = scfa_sum) %>%
  select(-starts_with("Week"),
         -starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Making Week 3 Data Frame from BRMPS and Total SCFAs
fecal3_tot <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Ph.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Butyrate.abs.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() %>%
  mutate(scfa_sum = rowSums(.[3:5]))

fecal3_none_tot <- merge(fecal3_tot,participantsupps2,by="Participant") %>%
  rename(scfa_sum_wk3 = scfa_sum) %>%
  select(-starts_with("Week"),
         #-starts_with("Supplement.consumed"),
         -starts_with("Quantity.compliant"))

#Combining Week 1 and Week 3 BRMPS-Total SCFAs DFs for Larger DF
tot_none <- merge(fecal1_none_tot,fecal3_none_tot,by="Participant") %>%
  select(starts_with("Participant"),
         starts_with("scfa_sum"))

#Appending Differences column to Total SCFA-BRMPS df in form: week3-week1
tot_none_diff <- tot_none %>%
  mutate(tot_diff = scfa_sum_wk3 - scfa_sum_wk1) %>%
  arrange(by = tot_diff)

#Creating Paired Boxplot for Week 1 vs Week 3 BRMPS-Total SCFA Data
#tot_wk1_vec <- as.vector(tot_brmps$scfa_sum_wk1)
#tot_wk3_vec <- as.vector(tot_brmps$scfa_sum_wk3)
#paired_tot_df <- data.frame(Week1 = tot_wk1_vec, Week3 = tot_wk3_vec)
#totpairplot <- ggpaired(paired_tot_df, cond1 = "Week1", cond2 = "Week3")
#totpairplot$layers <- totpairplot$layers[-2]

#Summary Statistics and Graphics for Week 1 vs. Week 3 BRMPS-Total SCFA
##t-test means (wk1-wk3) difference
t.test(as.vector(tot_none$scfa_sum_wk1), 
       as.vector(tot_none$scfa_sum_wk3),
       alternative = "less",
       paired = TRUE,
       conf.level = 0.95)
summary(tot_none_diff)
#totpairplot
totscfanone_barplot <- barplot(tot_none_diff$tot_diff, ylab = "Participants",
        xlab = "Tot. SCFA Conc. Change (Wk 3 - Wk 1)", 
        main = "No-Supp. Tot. SCFA Change from Week 1 to Week 3", 
        horiz =  TRUE)
nrow(tot_none_diff)

View(tot_none_diff)
```

##pH Change in No-Supp. Cohort from Week 1 to Week 3
```{r}
#Making Week 1 BRMPS 1x-pH Data Frame 
ph_none_wk1 <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week1") %>%
  na.omit() 

#Making Week 3 BRMPS 1x-pH Data Frame 
ph_none_wk3 <- fullfecalsample %>%
  select(-starts_with("avg.group.count"),
         -starts_with("Bristol.avg"),
         -starts_with("Final.weight.avg"),
         -starts_with("Acetate.abs.avg"),
         -starts_with("Acetate.rel.avg"),
         -starts_with("Butyrate.abs.avg"),
         -starts_with("Butyrate.rel.avg"),
         -starts_with("Propionate.abs.avg"),
         -starts_with("Propionate.rel.avg")) %>%
  filter(Week == "week3") %>%
  na.omit() 

#Combining Week 1 and Week 3 BRMPS 1x Daily Cohort 
merged_ph_wks <- merge(ph_none_wk1, ph_none_wk3, by = "Participant") 
merged_ph_none<- merge(merged_ph_wks, participantsupps2, by = "Participant")
merged_ph_none <- merged_ph_none %>%
  rename(ph_wk1 = "Ph.avg.x", ph_wk3 = "Ph.avg.y",) %>%
  select(starts_with("Participant"), starts_with("ph_wk")) %>%
  mutate(ph_diff = ph_wk3 - ph_wk1) %>%
  arrange(by_group = ph_diff) 

#Summary Statistics and Visualizations for BRMPS 1x Daily pH Change
nrow(merged_ph_none)  
t.test(as.vector(merged_ph_none$ph_wk1), 
       as.vector(merged_ph_none$ph_wk3),
       alternative = "greater",
       paired = TRUE,
       conf.level = 0.95) 
summary(merged_ph_none)
ph_none_barplot <- barplot(merged_ph_none$ph_diff, ylab = "Participants", 
        xlab = "pH (Week 3 - Week 1)", 
        main = "No-Supp. Change from Week 1 to Week 3", 
        horiz =  TRUE)

#Test exclusion of "extremes." Put together table with 1x, 2x, none in terms
#of the deltas between week 1 and week 3 for each of the SCFAs and Total. 
```

#-------------------------------------------------------------------------------
#Bristol vs. PH
##Bristol vs. PH for Week 1 and Week 3 (Participants Averaged)
```{r}
#Reading in Fecal Sample Data
fullfecalsample <- read.csv("./fecalsample.csv")
fecal_clean <- fullfecalsample %>%
  na.omit() %>%
  select(starts_with("Participant"), 
         starts_with("Week"),
         starts_with("Ph.avg"),
         starts_with("Bristol.avg")) %>%
  filter(Week == "week1" | Week == "week3") 

#Preparing Data for Scatterplot Creation 
fecal_clean$Ph.avg = as.numeric(fecal_clean$Ph.avg)
fecal_clean$Bristol.avg = as.numeric(fecal_clean$Bristol.avg)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_point(alpha=0.3) +
  ggtitle("PH vs. BRISTOL for All Weeks") +
  labs(y= "BRISTOL", x = "PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_smooth() +
  ggtitle("BRISTOL vs. PH for All Weeks") +
  labs(y= "BRISTOL", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_point() +
  geom_smooth() +
  ggtitle("BRISTOL vs. PH for All Weeks") +
  labs(y= "BRISTOL", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean$Ph.avg), as.vector(fecal_clean$Bristol.avg),
    method = "pearson") #Returns -0.01719789. Low negative correlation 

#Significance Statistics
brisph_norm<- qqplot(as.vector(fecal_clean$Ph.avg), as.vector(fecal_clean$Bristol.avg))
bartlett.test(Bristol.avg ~ Week, data = fecal_clean)
cor.test(as.vector(fecal_clean$Ph.avg), as.vector(fecal_clean$Bristol.avg), 
         alternative = "less", method = 'pearson')
```

##Bristol vs. PH for Week 1 Only 
```{r}
#Reading in Fecal Sample Data
fullfecalsample <- read.csv("./fecalsample.csv")
fecal_clean1 <- fullfecalsample %>%
  na.omit() %>%
  select(starts_with("Participant"), 
         starts_with("Week"),
         starts_with("Ph.avg"),
         starts_with("Bristol.avg")) %>%
  filter(Week == "week1") 

#Preparing Data for Scatterplot Creation 
fecal_clean1$Ph.avg = as.numeric(fecal_clean1$Ph.avg)
fecal_clean1$Bristol.avg = as.numeric(fecal_clean1$Bristol.avg)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean1, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Bristol Score", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean1, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_smooth() +
  ggtitle("Bristol vs. PH for Week 1") +
  labs(y= "Bristol", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean1, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_point() +
  geom_smooth() +
  ggtitle("Bristol vs. PH for Week 1") +
  labs(y= "Bristol", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean1$Ph.avg), as.vector(fecal_clean1$Bristol.avg),
    method = "pearson") #Returns 0.03556351. 

#Significance Statistics
cor.test(as.vector(fecal_clean1$Ph.avg), as.vector(fecal_clean1$Bristol.avg), 
         alternative = "less", method = 'pearson')
```

##Bristol vs. PH for Week 3 Only 
```{r}
#Reading in Fecal Sample Data
fullfecalsample <- read.csv("./fecalsample.csv")
fecal_clean3 <- fullfecalsample %>%
  na.omit() %>%
  select(starts_with("Participant"), 
         starts_with("Week"),
         starts_with("Ph.avg"),
         starts_with("Bristol.avg")) %>%
  filter(Week == "week3") 

#Preparing Data for Scatterplot Creation 
fecal_clean3$Ph.avg = as.numeric(fecal_clean3$Ph.avg)
fecal_clean3$Bristol.avg = as.numeric(fecal_clean3$Bristol.avg)

#Creating Scatterplot for SCFA vs. PH
ggplot(fecal_clean3, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_point(alpha=0.3) +
  ggtitle("SCFA vs. PH for Week 1") +
  labs(y= "Bristol Score", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH without Points
ggplot(fecal_clean3, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_smooth() +
  ggtitle("Bristol vs. PH for Week 1") +
  labs(y= "Bristol", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Creating Smoothed Conditional Means for SCFA vs. PH with Points
ggplot(fecal_clean3, aes(x=Ph.avg, y=Bristol.avg)) +
  geom_point() +
  geom_smooth() +
  ggtitle("Bristol vs. PH for Week 1") +
  labs(y= "Bristol", x = "Average PH") +
  theme(axis.text.x  = element_text(angle=0, hjust=0.5, size=11,colour
                                    ="black")) +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(breaks= pretty_breaks()) 

#Correlation Test
cor(as.vector(fecal_clean3$Ph.avg), as.vector(fecal_clean3$Bristol.avg),
    method = "pearson") #Returns -0.06560779. 

#Significance Statistics
cor.test(as.vector(fecal_clean3$Ph.avg), as.vector(fecal_clean3$Bristol.avg), 
         alternative = "less", method = 'pearson')

#Test for each sample again, similar to SCFA vs. PH. Do it "unaveraged." 
```